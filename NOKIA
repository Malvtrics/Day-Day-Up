UPDATE
      D
   SET
      D.SUBCATEGORY_CODE = ( CASE WHEN  EXISTS ( SELECT TOP 1
                                                         *
                                                      FROM
                                                         GP_RF_SUBCATEGORY
                                                      WHERE
                                                         SUBCATEGORY_CODE = S.REPLACEMENT_CODE ) THEN ( SELECT
                                                                                                            SUBCATEGORY_ID
                                                                                                         FROM
                                                                                                            GP_RF_SUBCATEGORY
                                                                                                         WHERE
                                                                                                            SUBCATEGORY_CODE = S.REPLACEMENT_CODE
                                                                                                      )
                                  ELSE D.SUBCATEGORY_CODE
                             END )
   FROM
      dbo.GP_WS_MODIAS_LOG_DETAIL D
      INNER JOIN GP_RF_SUBCATEGORY S
      ON D.SUBCATEGORY_CODE = S.SUBCATEGORY_CODE
         AND  ISNULL(S.REPLACEMENT_CODE , '') <> ''
      AND  ISNULL(S.SUBCATEGORY_CODE , '') <> ''

