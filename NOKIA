How to extend Part or AVL from ALMR

l  Check if the data can be imported into GPMA.

n  Import data from ALMR(install oracle and PLSQL - \\VS51GPM01\devsoftware\Oracle)

a.    Use PLSQL connect to (DATA SOURCE=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP) (HOST=fr712uodb002.zeu.alcatel-lucent.com) (PORT=1522)) (CONNECT_DATA=(SID=PIDB01)));USER ID=GPMA; Password=hpalgpma210;) and run below sql script to check records existing and part_family.

--Check status in ALMR to know if the part can be imported into GPMA

--Comment the family obj check when you try to check family in exclude list

select IDBDBA.CATALOG_PART.IPN,ACL,IDBDBA.CATALOG_PART.STATE,IDBDBA.CATALOG_PART.PART_CODE_STATUS,IDBDBA.ACL_PART.MODIFIED,IDBDBA.CATALOG_PART.MODIFIED,

IDBDBA.ACL_PART.STATE,IDBDBA.ACL_PART.ACL_PART_STATUS,IDBDBA.PART_FAMILY.part_family

from IDBDBA.CATALOG_PART 

inner join IDBDBA.ACL_PART on CATALOG_PART.obj_id = ACL_PART.ipn_obj_id

inner join IDBDBA.PART_FAMILY on PART_FAMILY_OBJ_ID= PART_FAMILY.obj_id

where exists(select 1 from IDBDBA.AML where IPN=CATALOG_PART.IPN and ACL=ACL_PART.ACL)

and ACL in ('AGL-IL','ASBF','AUSA','CID','LTETDD','MCD','OND','OPTICS','PAS','SRDE10','SSD','WCDMAB','WLBU','WRLS','WTD')

and CATALOG_PART.IPN in ('1AK30339AAAA ','1AK30340AAAA ','1AK30341AAAA ','1AK30342AAAA ','1AK30343AAAA ','1AK30344AAAA ','1AK30345AAAA') -- Update with new added part numbers.

--and PART_FAMILY_OBJ_ID NOT in( select obj_id from IDBDBA.PART_FAMILY

--where part_family in ('1aa generic document','1ab generic document','1ac generic document','1ad generic document','1af generic document','1ah generic document','2aa generic document','3JF Documents Region Europe & South','Business division standards','Corporate systems/tools','Non-Alcatel-Owned Software','OEM HW SW','Board or Platform Based on Telecom Std','External Periph/Access for IT/Networking','IT Server/Workstation & Add-On','IT Telecom Equip - Uniq Customer Config','Personal Computer Mono Proc. & Add-On','Z IT Equipment - External Peripherals','Z IT Equipment - Personal Computers','Z IT Equipment - Servers/Workstations','Z IT Networking Device','Z Mainframe','Z UNIX-WS/Server-configurations','IT & Telecom Eqt - Maintenance & Service','Stdalone/Rack Mountable Networking & AddOn','Z Datacom equipment','Z Telecom equipment'))

1)  Records exist and part_family is in the list under title (The part family are NOT in the following list ) of link(How to evaluate if a part in ALMR can be imported into GPMA)

                                                    i.          Run sql in PLSQL and export the records

--To export part data and import into TMP_IMP_ALMR_PART

select part.ORIGINATED, 

CASE WHEN part.IDB_MODIFICATION_DATE > acl.IDB_MODIFICATION_DATE THEN part.IDB_MODIFICATION_DATE ELSE acl.IDB_MODIFICATION_DATE END IDB_MODIFICATION_DATE,

acl.ACL,part.IPN,part.COMMODITY_CODE,CASE WHEN part.USE_CONCATENATED_DESCRIPTION = 'Yes' THEN part.CONCATENATED_DESCRIPTION ELSE part.DESCRIPTION END DESCRIPTION, 

part.UNIT_OF_MEASURE,part.STATE PART_STATE,part.PART_CODE_STATUS,acl.STATE ACL_STATE,acl.ACL_PART_STATUS

from IDBDBA.CATALOG_PART part inner join IDBDBA.ACL_PART acl

on part.OBJ_ID = acl.IPN_OBJ_ID WHERE EXISTS (SELECT 1 FROM IDBDBA.AML aml WHERE aml.IPN = acl.IPN AND aml.ACL = acl.ACL) 

AND acl.ACL in ('AGL-IL')  -- Update

and part.IPN in ('1AK10367AAAA')  -- Update

--To export AVL data and import into TMP_IMP_ALMR_AVL 

SELECT aml.ACL,aml.IPN,aml.MPN,aml.AMK,aml.AML_PART_STATUS,aml.ORIGINATED,aml.IDB_MODIFICATION_DATE

FROM IDBDBA.AML aml inner JOIN IDBDBA.CATALOG_PART part ON aml.IPN = part.IPN inner join IDBDBA.ACL_PART acl

on part.OBJ_ID = acl.IPN_OBJ_ID AND acl.ACL = aml.ACL

WHERE acl.ACL in ('AGL-IL') -- Update

and part.IPN in ('1AK10367AAAA')   -- Update

                

                                                   ii.          import data into TMP_IMP_ALMR_PART and TMP_IMP_ALMR_AVL

                                                 iii.          run script to insert new part and AVL

--Script to import data from ALMR manually through data import

--Clear tmp table first

TRUNCATE TABLE dbo.TMP_IMP_ALMR_PART

TRUNCATE TABLE dbo.TMP_IMP_ALMR_AVL

--Check tmp table after import the data from flat file

SELECT * FROM dbo.TMP_IMP_ALMR_PART  

SELECT * FROM dbo.TMP_IMP_ALMR_AVL

--Execute stored procedure to transfer data from temp table to ref part and ref AVL

EXEC dbo.GP_REF_IMP_ALMR_PART @PackageName = N'ALMR_REF_Import', -- nvarchar(50)

  @CurrentTime = '' -- varchar(20)

EXEC dbo.GP_REF_IMP_ALMR_AVL @PackageName = N'ALMR_REF_Import', -- nvarchar(50)

  @CurrentTime = '' -- varchar(20)  

                                                 iv.          If part family is not in the list, run below script after importing.

Update PRODUCT_CODE with the found part_family

--Manually add part referential, update the datatlist and system source

DECLARE @newSystemSource NVARCHAR(200),

       @foundSystemSource NVARCHAR(200),

       @datalist NVARCHAR(MAX),

       @productCode NVARCHAR(200)

              

       SELECT  @newSystemSource = 'AGL-IL',    --Update 

              @foundSystemSource = 'LU_AGILE',

              @datalist = '1AF01053AAAB',

              @productCode = 'IT Server/Workstation & Add-On'

              

--SELECT * FROM dbo.GP_RF_PART  WHERE PART_NUMBER IN (SELECT  value FROM    dbo.ConvertListToTable(@datalist, ',')) and SYSTEM_SOURCE = @newSystemSource

--SELECT * FROM dbo.GP_RF_APPROVED_VENDOR_LIST  WHERE PART_NUMBER IN (SELECT  value FROM    dbo.ConvertListToTable(@datalist, ',')) and SYSTEM_SOURCE = @newSystemSource 

       

update dbo.GP_RF_PART SET PRODUCT_CODE = @productCode 

WHERE PART_NUMBER IN (SELECT  value FROM    dbo.ConvertListToTable(@datalist, ',')) and SYSTEM_SOURCE = @newSystemSource

              

update dbo.GP_RF_APPROVED_VENDOR_LIST SET PRODUCT_CODE = @productCode 

WHERE PART_NUMBER IN (SELECT  value FROM    dbo.ConvertListToTable(@datalist, ',')) and SYSTEM_SOURCE = @newSystemSource

2)   Records not exist

                                                    i.          Refer to Copy data from GPMA

n  Copy data from GPMA

a.    Go to https://gpma.app.alcatel-lucent.com/GPM/refParts.aspx

b.   Choose LU_AGILE in system source and input the part number, then search

1)  Records exist and customers agree to extend data based on LU_AGILE in GPMA

                                                    i.          Update below script and run in GPMA pro database

--Manually add part referential, update the datatlist

INSERT INTO dbo.GP_RF_PART

        ( SYSTEM_SOURCE ,

          PART_NUMBER ,

          PART_DESC ,

          COMMODITY_CODE ,

          UOM_CODE ,

          REFERENCE_PART ,

          SOURCE ,

          CREATE_DATE ,

          CREATION_USER ,

          EXPIRY_DATE ,

          PART_STATUS ,

          PART_CREATIONDATE ,

          PART_UPDATEDATE ,

          PART_CREATIONUSER ,

          PART_UPDATEUSER ,

          PART_EFFECTIVE_STARTDATE ,

          PART_EFFECTIVE_ENDDATE ,

          PART_IMP_CREATIONDATE ,

          PART_IMP_UPDATEDATE ,

          PART_IMP_CREATIONUSER ,

          PART_IMP_UPDATEUSER ,

          PART_RANK ,

          PART_CALCULATED_STATUS ,

          PART_FINAL_STATUS ,

          PART_REPLACEMENT_CODE ,

          QA_ISPILOT ,

          QA_GROUP_ITEM_CODE ,

          QA_PARTCODE_TYPE ,

          MFR_PROFILE ,

          PART_REVISION ,

          PRODUCT_CODE ,

          SOURCE_DELETED

        )

SELECT  'AGL-IL' ,

        PART_NUMBER ,

        PART_DESC ,

        COMMODITY_CODE ,

        UOM_CODE ,

        REFERENCE_PART ,

        SOURCE ,

        CREATE_DATE ,

        CREATION_USER ,

        EXPIRY_DATE ,

        PART_STATUS ,

        PART_CREATIONDATE ,

        PART_UPDATEDATE ,

        'Validation Rule' ,

        'Validation Rule' ,

        PART_EFFECTIVE_STARTDATE ,

        PART_EFFECTIVE_ENDDATE ,

        PART_IMP_CREATIONDATE ,

        PART_IMP_UPDATEDATE ,

        PART_IMP_CREATIONUSER ,

        PART_IMP_UPDATEUSER ,

        PART_RANK ,

        PART_CALCULATED_STATUS ,

        PART_FINAL_STATUS ,

        PART_REPLACEMENT_CODE ,

        QA_ISPILOT ,

        QA_GROUP_ITEM_CODE ,

        QA_PARTCODE_TYPE ,

        MFR_PROFILE ,

        PART_REVISION ,

        PRODUCT_CODE ,

        SOURCE_DELETED FROM dbo.GP_RF_PART M WHERE PART_NUMBER IN (SELECT value FROM dbo.ConvertListToTable('1AK08597AAAA,1AK06270APAA',',')) 

        AND SYSTEM_SOURCE='LU_AGILE' 

        --AND PART_UPDATEUSER='PDM'

        AND NOT EXISTS (SELECT 1 FROM dbo.GP_RF_PART S WHERE S.SYSTEM_SOURCE='AGL-IL' AND S.PART_NUMBER=M.PART_NUMBER)

 

--Manually add AVL referential, update the datatlist

INSERT INTO dbo.GP_RF_APPROVED_VENDOR_LIST

        ( PART_NUMBER ,

          SYSTEM_SOURCE ,

          MANUFACTURER_CODE ,

          MANUFACTURER_PART_NUMBER ,

          QUALIFICATION_STATUS ,

          AVL_STATUS ,

          AVL_CREATIONDATE ,

          AVL_UPDATEDATE ,

          AVL_CREATIONUSER ,

          AVL_UPDATEUSER ,

          AVL_EFFECTIVE_STARTDATE ,

          AVL_EFFECTIVE_ENDDATE ,

          AVL_IMP_CREATIONDATE ,

          AVL_IMP_UPDATEDATE ,

          AVL_IMP_CREATIONUSER ,

          AVL_IMP_UPDATEUSER ,

          AVL_RANK ,

          AVL_CALCULATED_STATUS ,

          AVL_FINAL_STATUS ,

          AVL_REPLACEMENT_CODE ,

          AVL_SAP_HERS_NUMBER ,

          AVL_COMMERCIAL_PART_NUMBER ,

          DELETION_INDICATOR ,

          PURCH_STATUS_L ,

          PRODUCT_CODE ,

          SOURCE_DELETED ,

          REQUIRED_PACKING

        )

SELECT  PART_NUMBER ,

        'AGL-IL' ,

        MANUFACTURER_CODE ,

        MANUFACTURER_PART_NUMBER ,

        QUALIFICATION_STATUS ,

        AVL_STATUS ,

        AVL_CREATIONDATE ,

        AVL_UPDATEDATE ,

        'Validation Rule' ,

        'Validation Rule' ,

        AVL_EFFECTIVE_STARTDATE ,

        AVL_EFFECTIVE_ENDDATE ,

        AVL_IMP_CREATIONDATE ,

        AVL_IMP_UPDATEDATE ,

        AVL_IMP_CREATIONUSER ,

        AVL_IMP_UPDATEUSER ,

        AVL_RANK ,

        AVL_CALCULATED_STATUS ,

        AVL_FINAL_STATUS ,

        AVL_REPLACEMENT_CODE ,

        AVL_SAP_HERS_NUMBER ,

        AVL_COMMERCIAL_PART_NUMBER ,

        DELETION_INDICATOR ,

        PURCH_STATUS_L ,

        PRODUCT_CODE ,

        SOURCE_DELETED ,

        REQUIRED_PACKING FROM dbo.GP_RF_APPROVED_VENDOR_LIST M WHERE PART_NUMBER IN (SELECT value FROM dbo.ConvertListToTable('1AK08597AAAA,1AK06270APAA',',')) 

        AND SYSTEM_SOURCE='LU_AGILE' 

        --AND AVL_UPDATEUSER='PDM'

  AND NOT EXISTS (SELECT 1 FROM dbo.GP_RF_APPROVED_VENDOR_LIST S WHERE S.SYSTEM_SOURCE='AGL-IL' AND S.PART_NUMBER=M.PART_NUMBER AND S.MANUFACTURER_CODE=M.MANUFACTURER_CODE AND S.MANUFACTURER_PART_NUMBER=M.MANUFACTURER_PART_NUMBER) 

2)  Records not exist

                                                    i.          Reject the request

